#include QMK_KEYBOARD_H


enum layer_number {
    _BASE = 0,
    _MAC,
    _MGCAP,  // Magic CapsLock
    _MGCAP_MAC,
    _FN,
    _HOME,
};

enum custom_keycodes {
    NEW_LINE = SAFE_RANGE,
};

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    switch (keycode) {
    case NEW_LINE:
        if (record->event.pressed) {
            SEND_STRING(SS_TAP(X_END) SS_TAP(X_ENT));
        } else {}
        break;
    }
    return true;
}

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
//      C0           C1           C2           C3           C4           C5           C6           C7           C8           C9           C10          C11          C12          C13          C14
//  R0 ┌────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┐
//      ESC          F1           F2           F3           F4           F5           F6           F7           F8           F9           F10          F11          F12	         Prt          Rotary(Mute)
//  R1 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
//      ~            1            2            3            4            5            6            7            8            9            0             -           (=)	         BackSpc      Del
//  R2 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
//      Tab          Q            W            E            R            T            Y            U            I            O            P            [            ]            \            PgUp
//  R3 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
//      Caps         A            S            D            F            G            H            J            K            L            ;            "            Ente                      PgDn
//  R4 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┤
//      Sh_L         Z            X            C            V            B            N            M            ,            .            ?            Sh_R                      Up           End
//  R5 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┼────────────┤
//      Ct_L         Win_L        Alt_L                                  SPACE                                               Alt_R        FN           Ct_R         Left         Down         Right
//     └────────────┴────────────┴────────────┴─────────────────────────────────────────────────────────────────────────────┴────────────┴────────────┴────────────┴─────────────┴───────────┴────────────┘

    [_BASE] = LAYOUT(
//      C0           C1           C2           C3           C4           C5           C6           C7           C8           C9           C10          C11          C12          C13          C14
//  R0 ┌────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┐
        KC_ESC,      KC_F1,       KC_F2,       KC_F3,       KC_F4,       KC_F5,       KC_F6,       KC_F7,       KC_F8,       KC_F9,       KC_F10,      KC_F11,      KC_F12,      G(KC_L),     KC_MUTE,
//  R1 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        KC_GRV,      KC_1,        KC_2,        KC_3,        KC_4,        KC_5,        KC_6,        KC_7,        KC_8,        KC_9,        KC_0,        KC_MINS,     KC_EQL,      KC_BSPC,     TT(_MAC),
//  R2 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        KC_TAB,      KC_Q,        KC_W,        KC_E,        KC_R,        KC_T,        KC_Y,        KC_U,        KC_I,        KC_O,        KC_P,        KC_LBRC,     KC_RBRC,     KC_BSLS,     KC_PGUP,
//  R3 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
LT(_MGCAP, KC_CAPS), KC_A,        KC_S,        KC_D,        KC_F,        KC_G,        KC_H,        KC_J,        KC_K,        KC_L,        KC_SCLN,     KC_QUOT,     KC_ENT,                   KC_PGDN,
//  R4 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┤
        KC_LSFT,     KC_Z,        KC_X,        KC_C,        KC_V,        KC_B,        KC_N,        KC_M,        KC_COMM,     KC_DOT,      KC_SLSH,     KC_RSPC,                  KC_UP,       MO(_HOME),
//  R5 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┼────────────┤
        KC_LCTL,     KC_LGUI,     KC_LALT,                               KC_SPC,                                             KC_RALT,     MO(_FN),     KC_RCPC,     KC_LEFT,     KC_DOWN,     KC_RGHT
//     └────────────┴────────────┴────────────┴─────────────────────────────────────────────────────────────────────────────┴────────────┴────────────┴────────────┴─────────────┴───────────┴────────────┘
    ),

    [_MAC] = LAYOUT(
//      C0           C1           C2           C3           C4           C5           C6           C7           C8           C9           C10          C11          C12          C13          C14
//  R0 ┌────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┐
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,
//  R1 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,
//  R2 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,
//  R3 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
LT(_MGCAP_MAC, KC_CAPS), _______, _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,                  _______,
//  R4 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,                  _______,     _______,
//  R5 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┼────────────┤
        _______,     KC_LALT,     KC_LGUI,                               _______,                                            _______,     _______,     _______,     _______,     _______,     _______
//     └────────────┴────────────┴────────────┴─────────────────────────────────────────────────────────────────────────────┴────────────┴────────────┴────────────┴─────────────┴───────────┴────────────┘
    ),

    [_MGCAP] = LAYOUT(
//      C0           C1           C2           C3           C4           C5           C6           C7           C8           C9           C10          C11          C12          C13          C14
//  R0 ┌────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┐
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,
//  R1 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     KC_F1,       KC_F2,       KC_F3,       KC_F4,       KC_F5,       KC_F6,       KC_F7,       KC_F8,       KC_F9,       KC_F10,      KC_F11,      KC_F12,      KC_DEL,      _______,
//  R2 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     _______,     KC_BSPC,     KC_UP,       KC_DEL,      KC_HOME,     KC_PGUP,     C(KC_BSPC),  S(KC_UP),    C(KC_DEL),   _______,     _______,     _______,     _______,     _______,
//  R3 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     C(KC_LEFT),  KC_LEFT,     KC_DOWN,     KC_RGHT,     C(KC_RGHT), C(S(KC_LEFT)),S(KC_LEFT),  S(KC_DOWN),  S(KC_RIGHT),C(S(KC_RIGHT)),_______,    NEW_LINE,                 _______,
//  R4 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     KC_END,      KC_PGDN,     _______,     _______,     _______,     _______,     _______,                  KC_PGUP,     _______,
//  R5 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┼────────────┤
        _______,     _______,     _______,                               KC_ENT,                                             _______,     _______,     _______,     KC_HOME,     KC_PGDN,     KC_END
//     └────────────┴────────────┴────────────┴─────────────────────────────────────────────────────────────────────────────┴────────────┴────────────┴────────────┴─────────────┴───────────┴────────────┘
    ),

    [_MGCAP_MAC] = LAYOUT(
//      C0           C1           C2           C3           C4           C5           C6           C7           C8           C9           C10          C11          C12          C13          C14
//  R0 ┌────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┐
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,
//  R1 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     KC_F1,       KC_F2,       KC_F3,       KC_F4,       KC_F5,       KC_F6,       KC_F7,       KC_F8,       KC_F9,       KC_F10,      KC_F11,      KC_F12,      KC_DEL,      _______,
//  R2 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     _______,     KC_BSPC,     KC_UP,       KC_DEL,      KC_HOME,     KC_PGUP,     C(KC_BSPC),  S(KC_UP),    C(KC_DEL),   _______,     _______,     _______,     _______,     _______,
//  R3 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     A(KC_LEFT),  KC_LEFT,     KC_DOWN,     KC_RGHT,     A(KC_RGHT), A(S(KC_LEFT)),S(KC_LEFT),  S(KC_DOWN),  S(KC_RIGHT),A(S(KC_RIGHT)),_______,    NEW_LINE,                 _______,
//  R4 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     KC_END,      KC_PGDN,     _______,     _______,     _______,     _______,     _______,                  KC_PGUP,     _______,
//  R5 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┼────────────┤
        _______,     _______,     _______,                               KC_ENT,                                             _______,     _______,     _______,     KC_HOME,     KC_PGDN,     KC_END
//     └────────────┴────────────┴────────────┴─────────────────────────────────────────────────────────────────────────────┴────────────┴────────────┴────────────┴─────────────┴───────────┴────────────┘
    ),

    [_FN] = LAYOUT(
//      C0           C1           C2           C3           C4           C5           C6           C7           C8           C9           C10          C11          C12          C13          C14
//  R0 ┌────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┐
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,
//  R1 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     C(A(KC_DEL)),RGB_TOG,
//  R2 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     RESET,       RGB_MOD,
//  R3 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,                  RGB_RMOD,
//  R4 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,                  _______,     _______,
//  R5 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┼────────────┤
        _______,     _______,     _______,                               _______,                                            _______,     _______,     _______,     _______,     _______,     _______
//     └────────────┴────────────┴────────────┴─────────────────────────────────────────────────────────────────────────────┴────────────┴────────────┴────────────┴─────────────┴───────────┴────────────┘
    ),

    [_HOME] = LAYOUT(
//      C0           C1           C2           C3           C4           C5           C6           C7           C8           C9           C10          C11          C12          C13          C14
//  R0 ┌────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┬────────────┐
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,
//  R1 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,
//  R2 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,
//  R3 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,                  _______,
//  R4 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┤
        _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,     _______,                  _______,     _______,
//  R5 ├────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼────────────┼─────────────────────────┼────────────┼────────────┤
        _______,     _______,     _______,                               _______,                                            _______,     _______,     _______,     _______,     _______,     _______
//     └────────────┴────────────┴────────────┴─────────────────────────────────────────────────────────────────────────────┴────────────┴────────────┴────────────┴─────────────┴───────────┴────────────┘
    ),

};


bool encoder_update_user(uint8_t index, bool clockwise) {
    if (index == 0) {
        switch(biton32(layer_state)){
            case _MGCAP:
                if (clockwise){
                    tap_code16(C(KC_TAB));
                } else{
                    tap_code16(S(C(KC_TAB)));
                }
                break;
            case _MGCAP_MAC:
                if (clockwise){
                    tap_code16(C(KC_TAB));
                } else{
                    tap_code16(S(C(KC_TAB)));
                }
                break;
            case _HOME:
                if (clockwise){
                    tap_code16(KC_WH_R);
                } else{
                    tap_code16(KC_WH_L);
                }
                break;
            default:
                if (clockwise) {
                    tap_code16(KC_VOLD);
                } else {
                    tap_code16(KC_VOLU);
                }
                break;
            }
        }
    return true;
}

void rgb_matrix_indicators_advanced_user(uint8_t led_min, uint8_t led_max) {
    
	if (IS_HOST_LED_ON(USB_LED_CAPS_LOCK)) {
        rgb_matrix_set_color_all(255, 0, 0);
    }
    switch(get_highest_layer(layer_state)){
        case _MGCAP:
            RGB_MATRIX_INDICATOR_SET_COLOR(0, 255, 0, 255);
            break;
        case _FN:
            rgb_matrix_set_color_all(0, 0, 255);
            break;
        case _HOME:
            rgb_matrix_set_color_all(255, 255, 0);
            break;
        case _MAC:
            rgb_matrix_set_color_all(255, 255, 255);
            break;
        default:
            break;
        break;
    }
}